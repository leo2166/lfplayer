# Variables de Entorno para Sistema Multi-Cuenta R2

## Variables Existentes (Cuenta 1)
Estas ya están configuradas en Vercel y deben permanecer sin cambios:

```env
CLOUDFLARE_R2_ACCOUNT_ID="2e4ce46b69496d4672be6e105ad32329"
CLOUDFLARE_R2_ACCESS_KEY_ID="[ya configurado]"
CLOUDFLARE_R2_SECRET_ACCESS_KEY="[ya configurado]"
CLOUDFLARE_R2_BUCKET_NAME="lfplayer"
NEXT_PUBLIC_CLOUDFLARE_R2_PUBLIC_URL="[ya configurado]"
```

## Nuevas Variables para Cuenta 2
Añade estas nuevas variables en Vercel:

```env
CLOUDFLARE_R2_ACCOUNT_ID_2="ef00c93cf25c2564210cdb1e387c0586"
CLOUDFLARE_R2_ACCESS_KEY_ID_2="c4bb622049118a962c15104b6e821d66"
CLOUDFLARE_R2_SECRET_ACCESS_KEY_2="dc666bcb87c89eb6b23dcecdf427d2df5c449eab3087bc8255ef9f9bbeedf2"
CLOUDFLARE_R2_BUCKET_NAME_2="lfplayer-2"
NEXT_PUBLIC_CLOUDFLARE_R2_PUBLIC_URL_2="https://pub-2f774f2a26ea44feb5ee92f7c8471093.r2.dev"
```

## Instrucciones para Añadir en Vercel

1. Ve a tu proyecto en Vercel Dashboard
2. Settings → Environment Variables
3. Añade cada una de las 5 nuevas variables (las que terminan en _2)
4. Asegúrate de que estén disponibles para todos los entornos (Production, Preview, Development)
5. Guarda los cambios

## Antes del Deploy

**IMPORTANTE:** Antes de hacer el deploy, ejecuta este script SQL en Supabase:

```sql
-- En Supabase SQL Editor, ejecuta:
-- scripts/010_create_storage_buckets_table.sql
```

Esto creará la tabla `storage_buckets` y añadirá la columna `storage_account_number` a la tabla `songs`.

## Verificación Post-Deploy

Después del deploy, verifica que todo funciona correctamente:

1. **Subir una canción**: Debe funcionar normalmente (usará cuenta R2 #1 si hay espacio)
2. **Verificar endpoint de monitoreo**: 
   - Como admin, accede a `/api/storage-status`
   - Debe retornar JSON con uso de ambas cuentas
3. **Simular switch automático**:
   - En Supabase, ejecuta:
     ```sql
     UPDATE storage_buckets 
     SET current_usage_bytes = 10627787776 
     WHERE account_number = 1;
     ```
   - Sube una nueva canción
   - Debe guardarse en cuenta R2 #2
